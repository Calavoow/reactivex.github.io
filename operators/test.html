<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <canvas id="rxCanvas" width="578" height="400" style="border: 1px solid #000000; margin: 10px;"></canvas>
    <script>
     
        var canvas = document.getElementById('rxCanvas');

        draw_arrow = function (ctx, fromx, tox, y) {
            var headlen = 25;
            ctx.beginPath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#000000';
            ctx.moveTo(fromx, y);
            ctx.lineTo(tox, y);
            ctx.moveTo(tox, y - 0.5*headlen);
            ctx.lineTo(tox+headlen, y);
            ctx.lineTo(tox, y + 0.5*headlen);
            ctx.closePath();
            ctx.stroke();
        } 

        draw_circle = function (ctx, centerx, centery, color) {
            circle (ctx, centerx, centery, color, function(ctx) { 
                ctx.stroke(); 
            });
        }

        fill_circle = function (ctx, centerx, centery, color) {
            circle (ctx, centerx, centery, color, function(ctx) { 
                ctx.fill(); 
            });
        }

        circle = function (ctx, centerx, centery, color, drawFunc) {
            var radius = 25;
            ctx.beginPath();
            ctx.arc(centerx, centery, radius, 0, 2 * Math.PI, false);
            ctx.fillStyle = color;
            drawFunc(ctx);
            ctx.lineWidth = 5;
            ctx.strokeStyle = '#003300';
            ctx.stroke();
        }

        draw_stream = function (ctx, stream) {
            draw_arrow (ctx, 10, canvas.width - 35, stream.y);
            for (var i in stream.events) {
                fill_circle (ctx, stream.events[i].x, stream.y, stream.events[i].color);
            }

            ctx.beginPath();
            ctx.lineWith = 5;
            ctx.strokeStyle = '#000000';
            ctx.moveTo(stream.end, stream.y - 25);
            ctx.lineTo(stream.end, stream.y + 25);
            ctx.stroke();
        }

        randomColor = function() {
            return '#'+(Math.random()*0xFFFFFF<<0).toString(16);
        }

        stream = {
            y: canvas.height / 2,
            events: [
                { x: 60, color: 'green' },
                { x: 160, color: 'red' },
                { x: 305, color: 'blue' }
                ],
            end: 450
        }

        render = function (canvas, evt) {
            var ctx = canvas.getContext('2d');
            var mousePos = getMousePos(canvas, evt);
            var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = '18pt Calibri';
            ctx.fillStyle = 'black';
            ctx.fillText(message, 10, 25);

            draw_stream (ctx, stream);
            draw_circle (ctx, mousePos.x, stream.y, 'red');
        }

        getMousePos = function (canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return evt != null ? { x: evt.clientX - rect.left,
                                   y: evt.clientY - rect.top } 
                               : { x: 0, y: 0};
        }
        
        canvas.addEventListener('mousemove', function(evt) {
            render (canvas, evt);
        }, false);

        canvas.addEventListener('mousedown', function(evt) {
            var mousePos = getMousePos(canvas, evt); 
            stream.events.push({ x: mousePos.x, color: randomColor() });
            render (canvas, evt);
        }, false);

        render (canvas, null);

    </script>
  </body>
</html>
