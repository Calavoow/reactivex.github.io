<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <canvas id="rxCanvas" width="578" height="400" style="border: 1px solid #000000; margin: 10px;"></canvas>
    <script>
     
        var canvas = document.getElementById('rxCanvas');

        var eventRadius = 25;

        var streams = [
            {
                shape: "circle",
                y: canvas.height / 8,
                events: [],
                end: 450
            },
            {
                shape: "square",
                y: canvas.height / 8 * 3,
                events: [],
                end: 470
            }
        ];

        var currStream = streams[0];

        draw_line = function (ctx, fromx, fromy, tox, toy, color) {
            ctx.beginPath();
            ctx.lineWith = 3;
            ctx.strokeStyle = color;
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.stroke();
        }

        draw_arrow = function (ctx, fromx, tox, y) {
            var headlen = 25;
            ctx.beginPath();
            ctx.lineWidth = 3;
            ctx.strokeStyle = '#000000';
            ctx.moveTo(fromx, y);
            ctx.lineTo(tox, y);
            ctx.moveTo(tox, y - 0.5*headlen);
            ctx.lineTo(tox+headlen, y);
            ctx.lineTo(tox, y + 0.5*headlen);
            ctx.closePath();
            ctx.stroke();
        } 

        draw_circle = function (ctx, centerx, centery, color, isMarked) {
            circle (ctx, centerx, centery, color, isMarked, function(ctx) { 
                ctx.stroke(); 
            });
        }

        fill_circle = function (ctx, centerx, centery, color, isMarked) {
            circle (ctx, centerx, centery, color, isMarked, function(ctx) { 
                ctx.fill(); 
            });
        }

        circle = function (ctx, centerx, centery, color, isMarked, drawFunc) {
            ctx.beginPath();
            ctx.arc(centerx, centery, eventRadius, 0, 2 * Math.PI, false);
            ctx.fillStyle = color;
            drawFunc(ctx);
            ctx.lineWidth = 3;
            ctx.strokeStyle = isMarked ? 'red' : '#003300';
            ctx.stroke();
        }
    
        draw_square = function (ctx, centerx, centery, color, isMarked) {
            square (ctx, centerx, centery, color, isMarked, false);
        }

        fill_square = function (ctx, centerx, centery, color, isMarked) {
            square (ctx, centerx, centery, color, isMarked, true);
        }

        square = function (ctx, centerx, centery, color, isMarked, doFill) {
            ctx.beginPath();
            ctx.rect(centerx-eventRadius, centery-eventRadius, 2*eventRadius, 2*eventRadius);
            if (doFill) {
                ctx.fillStyle = color;
                ctx.fill();
            }
            ctx.lineWidth = 3;
            ctx.strokeStyle = isMarked ? 'red' : '#003300';
            ctx.stroke();
        }

        draw_stream = function (ctx, stream) {
            draw_arrow (ctx, 10, canvas.width - 35, stream.y);
            for (var i in stream.events) {
                var evt = stream.events[i];
                switch (stream.shape) {
                    case "circle":
                        fill_circle (ctx, evt.x, stream.y, evt.color, false);
                        break;
                    case "square":
                        fill_square (ctx, evt.x, stream.y, evt.color, false);
                        break;
                }
            }
            draw_line(ctx, stream.end, stream.y - eventRadius, stream.end, stream.y + eventRadius, '#000000');
        }

        randomColor = function() {
            return '#'+(Math.random()*0xFFFFFF<<0).toString(16);
        }

        render = function (canvas, mousePos) {
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            /*var message = mousePos.x + ',' + mousePos.y;
            ctx.font = '18pt Calibri';
            ctx.fillStyle = 'black';
            ctx.fillText(message, 10, 25);*/

            for (var i in streams) {
                draw_stream (ctx, streams[i]);
            }

            if (Math.abs(mousePos.y - currStream.y) < 2*eventRadius) {
                var isMarked = isOnEvent(mousePos);
                switch (currStream.shape) {
                    case "circle":
                        draw_circle (ctx, mousePos.x, currStream.y, 'red', isMarked);
                        break;
                    case "square":
                        draw_square (ctx, mousePos.x, currStream.y, 'red', isMarked);
                        break;
                }
            }
        }

        getCurrentStream = function (mousePos) {
            var minDistance = Number.POSITIVE_INFINITY;
            var selectedStream = currStream;
            for (var i in streams) {
                var stream = streams[i];
                var distance = Math.abs(stream.y - mousePos.y);
                if (distance < minDistance) {
                    minDistance = distance;
                    selectedStream = stream;
                }
            }
            return selectedStream;
        }

        isOnEvent = function (mousePos) {
            for (var i in currStream.events) {
                var evt = currStream.events[i];
                if (Math.abs(evt.x - mousePos.x) < 2*eventRadius) {
                    return true;
                }
            }
            return false;
        }
            
        removeEvent = function (mousePos) {
            for (var i in currStream.events) {
                var evt = currStream.events[i];
                if (Math.abs(evt.x - mousePos.x) < 2*eventRadius) {
                    delete currStream.events[i];
                }
            }
        }

        getMousePos = function (canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return evt != null ? { x: evt.clientX - rect.left,
                                   y: evt.clientY - rect.top } 
                               : { x: 0, y: 0};
        }
        
        canvas.addEventListener('mousemove', function(evt) {
            var mousePos = getMousePos(canvas, evt); 
            currStream = getCurrentStream(mousePos);
            render (canvas, mousePos);
        }, false);

        canvas.addEventListener('mousedown', function(evt) {
            var mousePos = getMousePos(canvas, evt); 
            if (Math.abs(mousePos.y - currStream.y) < 2*eventRadius) {
                isOnEvent(mousePos) ? removeEvent(mousePos) 
                                    : currStream.events.push({ x: mousePos.x, color: randomColor() });
                render (canvas, mousePos);
            }
        }, false);


        canvas.addEventListener ("mouseout", function(evt) { 
            var mousePos = { x:-1337, y:-1337 };
            render (canvas, mousePos);
        }, false);

        render (canvas, getMousePos(canvas, null));

    </script>
  </body>
</html>
